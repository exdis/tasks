/* exdisme - v0.0.1 - 2014-05-17 */
define(["angular","services","jquery","moment"],function(a,b,c,d){"use strict";var e=a.module("app.controllers",["app.services"]);e.controller("ctrl",["$scope","Tasks","$http","$route",function(b,e,f){b.init=function(a){"undefined"!=typeof b.currentUser&&e.get({id:b.currentUser,page:a},function(c){b.count=c.count,b.tasks=c.tasks,b.pageTotal=Math.ceil(parseInt(b.count)/20),b.pagination={cur:a,total:b.pageTotal,display:10}})},b.total=function(c){var e=0;a.forEach(b.tasks,function(a){e+=parseInt(a.time)});var f,g=d.duration(e);return f=c?g.asHours()*b.settings.cost:Math.floor(g.asHours())+"hours "+g.get("minutes")+"minutes "+g.get("seconds")+"seconds"},b.submit=function(){var a=b.form,e=a.time.match(/\d+h/),g=a.time.match(/\d+m/),h=a.time.match(/\d+s/),i=d.duration({hours:e?parseInt(e[0].replace("h","")):0,minutes:g?parseInt(g[0].replace("m","")):0,seconds:h?parseInt(h[0].replace("s","")):0});a.time=i.asMilliseconds(),a.userid=b.currentUser,f.post("api/tasks",JSON.stringify(a)).success(function(a){"OK"===a.status&&(c("#new").modal("hide"),c(".navbar-collapse").hasClass("in")&&c(".navbar-toggle").click(),b.init(b.pagination.cur),b.form={})})},b.submitSettings=function(){var a=b.settings;f.put("api/users/"+b.currentUser,JSON.stringify(a)).success(function(a){"OK"===a.status&&(c("#settings").modal("hide"),c(".navbar-collapse").hasClass("in")&&c(".navbar-toggle").click())})},b.taskDelete=function(a){f.delete("api/tasks/"+a);var d=b.tasks.indexOf(a);b.tasks.splice(d,1),c(".navbar-collapse").hasClass("in")&&c(".navbar-toggle").click(),b.init(b.pagination.cur)}}])});
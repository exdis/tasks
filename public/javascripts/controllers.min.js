/* exdisme - v0.0.1 - 2014-05-03 */
define(["angular","services","jquery","moment"],function(a,b,c,d){"use strict";var e=a.module("app.controllers",["app.services"]);e.controller("ctrl",["$scope","Tasks","$http","$route",function(b,e,f,g){b.init=function(a){"undefined"!=typeof b.currentUser&&e.get({id:b.currentUser,page:a},function(c){b.count=c.count,b.tasks=c.tasks,b.pageTotal=Math.ceil(parseInt(b.count)/20),b.pagination={cur:a,total:b.pageTotal,display:10}})},b.total=function(){var c=0;a.forEach(b.tasks,function(a){c+=parseInt(a.time)});var e=d.duration(c),f=e.get("hours")+"hours "+e.get("minutes")+"minutes "+e.get("seconds")+"seconds";return f},b.submit=function(){var a=b.form,e=a.time.match(/\d+h/),h=a.time.match(/\d+m/),i=a.time.match(/\d+s/),j=d.duration({hours:e?parseInt(e[0].replace("h","")):0,minutes:h?parseInt(h[0].replace("m","")):0,seconds:i?parseInt(i[0].replace("s","")):0});a.time=j.asMilliseconds(),a.userid=b.currentUser,f.post("api/tasks",JSON.stringify(a)).success(function(a){"OK"===a.status&&(c("#new").modal("hide"),c(".navbar-collapse").hasClass("in")&&c(".navbar-toggle").click(),g.reload(),b.form={})})},b.taskDelete=function(a){f.delete("api/tasks/"+a),c(".navbar-collapse").hasClass("in")&&c(".navbar-toggle").click(),g.reload()}}])});